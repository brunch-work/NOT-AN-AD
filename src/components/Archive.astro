---
import { archiveQuery, type Asset } from "../gql/queries";

const response = await fetch("https://graphql.datocms.com/", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    Accept: "application/json",
    Authorization: `Bearer ${import.meta.env.DATOCMS_API_KEY}`,
  },
  body: JSON.stringify({
    query: archiveQuery,
  }),
});

const json = await response.json();
const { archive } = json.data;
---

<div class="subgrid archive">
  {
    archive.assets.map((asset: Asset) => {
      console.log(asset);

      if (asset._modelApiKey === "image_asset") {
        return (
          <div class="archive-item">
            <a href={`/media/${asset.asset.id}`}>
              <img src={asset.asset.url} alt={asset.asset.alt} />
            </a>
          </div>
        );
      }

      if (asset._modelApiKey === "video_asset") {
        return (
          <div class="archive-item">
            <a href={`/media/${asset.asset.id}`}>
              <video src={asset.preview.video.mp4Url} muted />
            </a>
          </div>
        );
      }
    })
  }
</div>
